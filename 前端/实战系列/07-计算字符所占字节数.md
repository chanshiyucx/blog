# è®¡ç®—å­—ç¬¦æ‰€å å­—èŠ‚æ•°

ä»£ç å‚è€ƒï¼š[ç”¨ JS è®¡ç®—å­—ç¬¦æ‰€å å­—èŠ‚æ•°](https://gist.github.com/nuintun/9955353)

## UTF-8

UTF-8 ä¸€ç§å¯å˜é•¿åº¦çš„ Unicode ç¼–ç æ ¼å¼ï¼Œä½¿ç”¨ä¸€è‡³å››ä¸ªå­—èŠ‚ä¸ºæ¯ä¸ªå­—ç¬¦ç¼–ç ï¼ˆUnicode åœ¨èŒƒå›´ D800-DFFF ä¸­ä¸å­˜åœ¨ä»»ä½•å­—ç¬¦ï¼‰ï¼Œå…³äº UFT-8 å­—ç¬¦è¯¦æƒ…å¯æŸ¥é˜… [UTF-8](https://zh.wikipedia.org/wiki/UTF-8)ã€‚

- 000000 - 00007F(128 ä¸ªä»£ç ) 0zzzzzzz(00-7F) ä¸€ä¸ªå­—èŠ‚
- 000080 - 0007FF(1920 ä¸ªä»£ç ) 110yyyyy(C0-DF) 10zzzzzz(80-BF) ä¸¤ä¸ªå­—èŠ‚
- 000800 - 00D7FF
- 00E000 - 00FFFF(61440 ä¸ªä»£ç ) 1110xxxx(E0-EF) 10yyyyyy 10zzzzzz ä¸‰ä¸ªå­—èŠ‚
- 010000 - 10FFFF(1048576 ä¸ªä»£ç ) 11110www(F0-F7) 10xxxxxx 10yyyyyy 10zzzzzz å››ä¸ªå­—èŠ‚

## UTF-16

UTF-16 ç¼–ç  65535 ä»¥å†…ä½¿ç”¨ä¸¤ä¸ªå­—èŠ‚ç¼–ç ï¼Œè¶…å‡º 65535 çš„ä½¿ç”¨å››ä¸ªå­—èŠ‚ï¼ˆJS å†…éƒ¨ï¼Œå­—ç¬¦å‚¨å­˜æ ¼å¼æ˜¯ï¼šUCS-2â€”â€”UTF-16 çš„å­çº§ï¼‰ï¼Œå…³äº UFT-16 å­—ç¬¦è¯¦æƒ…å¯æŸ¥é˜… [UTF-16](https://zh.wikipedia.org/wiki/UTF-16)ã€‚

- 000000 - 00FFFF ä¸¤ä¸ªå­—èŠ‚
- 010000 - 10FFFF å››ä¸ªå­—èŠ‚

## GBK

GBK(ASCII çš„ä¸­æ–‡æ‰©å±•) é™¤äº† 0~126 ç¼–å·æ˜¯ 1 ä¸ªå­—èŠ‚ä¹‹å¤–ï¼Œå…¶ä»–éƒ½ 2 ä¸ªå­—èŠ‚ï¼ˆè¶…è¿‡ 65535 ä¼šç”± 2 ä¸ªå­—æ˜¾ç¤ºï¼‰ï¼Œå…³äº GBK å­—ç¬¦è¯¦æƒ…å¯æŸ¥é˜… [æ±‰å­—å†…ç æ‰©å±•è§„èŒƒ](https://zh.wikipedia.org/wiki/æ±‰å­—å†…ç æ‰©å±•è§„èŒƒ)ã€‚

## ä»£ç å®ç°

éœ€è¦æ³¨æ„ï¼š`String.prototype.charCodeAt` åªèƒ½è¿”å› `0xffff` ä»¥å†…çš„æ•°å€¼ï¼Œéœ€è¦ç”¨ `String.prototype.codePointAt` æ›¿æ¢ã€‚

```javascript
/**
 * @param  {String} str
 * @param  {String} [charset= 'gbk'] utf-8, utf-16
 * @return {Number}
 */
function sizeofByte(str, charset = "gbk") {
  let total = 0
  let charCode

  charset = charset.toLowerCase()

  if (charset === "utf-8" || charset === "utf8") {
    for (let i = 0, len = str.length; i < len; i++) {
      charCode = str.codePointAt(i)

      if (charCode <= 0x007f) {
        total += 1
      } else if (charCode <= 0x07ff) {
        total += 2
      } else if (charCode <= 0xffff) {
        total += 3
      } else {
        total += 4
        i++
      }
    }
  } else if (charset === "utf-16" || charset === "utf16") {
    for (let i = 0, len = str.length; i < len; i++) {
      charCode = str.codePointAt(i)

      if (charCode <= 0xffff) {
        total += 2
      } else {
        total += 4
        i++
      }
    }
  } else {
    total = str.replace(/[^\x00-\xff]/g, "aa").length
  }

  return total
}

/* ä½¿ç”¨æµ‹è¯• */
console.log(sizeofByte("ğŸ’©"), sizeofByte("å“ˆ"), sizeofByte("Â©")) // => 4 2 1
```
